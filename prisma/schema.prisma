// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// 1. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á User
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  
  // Relations
  builds    Build[]
  orders    Order[]
  favorites UserFavorite[]
}

enum Role {
  USER
  ADMIN
}

// 2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)
model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  stock       Int      @default(0)
  image       String?
  category    Category // ‡πÉ‡∏ä‡πâ Enum ‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á
  specs       Json?    // ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡πÄ‡∏õ‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  orderItems  OrderItem[]
  buildItems  BuildItem[]
  favoritedBy UserFavorite[]
}

// üî• ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà)
enum Category {
  // ‡∏Ñ‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö
  CPU
  MOTHERBOARD
  RAM
  GPU
  STORAGE
  PSU
  CASE
  COOLER
  MONITOR
  
  // üî• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î IT ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
  LAPTOP      // ‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Å
  DESKTOP     // ‡∏Ñ‡∏≠‡∏°‡∏ä‡∏∏‡∏î
  MOUSE       // ‡πÄ‡∏°‡∏≤‡∏™‡πå
  KEYBOARD    // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
  HEADSET     // ‡∏´‡∏π‡∏ü‡∏±‡∏á
  CHAIR       // ‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á
  ACCESSORY   // ‡∏™‡∏≤‡∏¢‡πÑ‡∏ü/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°
}

// 3. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á "‡∏à‡∏±‡∏î‡∏™‡πÄ‡∏õ‡∏Ñ"
model Build {
  id          String      @id @default(uuid())
  name        String
  totalPrice  Decimal
  userId      String
  user        User        @relation(fields: [userId], references: [id])
  items       BuildItem[]
  createdAt   DateTime    @default(now())
}

model BuildItem {
  id        String  @id @default(uuid())
  buildId   String
  build     Build   @relation(fields: [buildId], references: [id], onDelete: Cascade)
  productId String
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int     @default(1)
}

// 4. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
model Order {
  id        String      @id @default(uuid())
  userId    String
  user      User        @relation(fields: [userId], references: [id])
  status    OrderStatus @default(PENDING)
  total     Decimal
  items     OrderItem[]
  createdAt DateTime    @default(now())
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  COMPLETED
  CANCELLED
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Decimal
}

// 5. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î
model UserFavorite {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, productId])
}